<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script
	src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 총 금액 출력
    function updateTotalPrice() {
        let totalPrice = 0;
        const selectedItems = document.querySelectorAll(".item-checkbox:checked");
        selectedItems.forEach(item => {
            const row = item.closest("tr");
            const price = parseFloat(row.querySelector("td:nth-child(4)").textContent.replace(/[^\d.-]/g, ""));
            const quantity = parseInt(row.querySelector("td:nth-child(5)").textContent, 10);
            totalPrice += price * quantity;
        });

        // 총 금액을 totalPriceText에 업데이트
        const totalPriceText = document.getElementById("totalPriceText");
        totalPriceText.textContent = "총 금액: " + totalPrice + " 원";
    }

    // 체크박스 클릭 시 즉시 총 금액 계산
    document.querySelectorAll(".item-checkbox").forEach(checkbox => {
        checkbox.addEventListener("change", updateTotalPrice);
    });
});
</script>
<script src="https://js.tosspayments.com/v1"></script>
<script th:src="@{/js/editor.js}"></script>
<script type="module" th:src="@{/js/mylist.js}"></script>
<script type="module" th:src="@{/js/order.js}"></script>
</head>
<body>
	<section layout:fragment="content" class="content-box d-flex"
		style="gap: 30px; padding-top: 30px;">
		<div class="text-center bg-body-secondary" style="width: 200px;">
			<h6
				class="m-0 py-3 border-bottom border-secondary-subtle text-body-emphasis">
				<a href="order">마이 페이지</a>
			</h6>
			<ul class="p-0 text-center">
				<li class="mt-2 text-body-emphasis"><a href="order">내 주문/배송</a></li>
				<li class="mt-2 text-body-emphasis"><a href="review">내 리뷰</a></li>
				<li class="mt-2 text-body-emphasis"><a href="qna">내 Q&A</a></li>
			</ul>
		</div>
		<div class="d-flex flex-column gap-3 w-100">
			<div class="my-content" id="myQAContent">
				<div>
					<table class="table-type-a">
						<thead>
							<tr>
								<!-- 전체 선택 체크박스 -->
								<th><input type="checkbox" id="selectAll" /></th>
								<th>상품이미지</th>
								<th>상품명</th>
								<th>판매가</th>
								<th>수량</th>
								<th>평점</th>
							</tr>
						</thead>
						<tbody>
							<tr th:if="${#lists.isEmpty(carts)}">
								<td colspan="2">---- 장바구니 내역이 없습니다. ----</td>
							</tr>
							<tr th:each="item : ${carts}"
								th:unless="${#lists.isEmpty(carts)}">
								<!-- 상품별 체크박스 -->
								<td><input type="checkbox" class="item-checkbox"
									th:attr="data-cart-id=${item.cartId}" /></td>
								<td th:text="${item.productImageUrl}" />
								<td th:text="${item.productName}" />
								<td th:text="${item.productPrice}" />
								<td th:text="${item.quantity}" />
								<td th:text="${item.avgRating}" />
							</tr>
						</tbody>
					</table>
				</div>
				<div class="mt-3 d-flex justify-content-start gap-2">
					<button class="btn btn-secondary" id="deleteAll">장바구니 비우기</button>
					<button class="btn btn-danger" id="deleteSelected">선택 삭제</button>
					<button class="btn btn-primary" id="checkCompatibilityBtn">부품
						호환성 체크</button>
				</div>
				<div id="totalPriceContainer">
					<!-- 총 금액 출력 -->
					<span id="totalPriceText">총 금액: 0 원</span>
					<button class="btn btn-success" id="placeOrderBtn" data-flag="cart">주문하기</button>
				</div>
			</div>
		</div>
	</section>
</body>
</html>
