<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script
	src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
    //전체 선택 체크박스 클릭
    document.getElementById("selectAll").addEventListener("change", function() {
        const checkboxes = document.querySelectorAll(".item-checkbox");
        checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        updateTotalPrice();
    });

    //선택 삭제 버튼 클릭
    document.getElementById("deleteSelected").addEventListener("click", function() {
        const selectedItems = document.querySelectorAll(".item-checkbox:checked");
        selectedItems.forEach(item => {
            item.closest("tr").remove();
        });
        updateTotalPrice();
    });

    //전체 삭제 버튼 클릭
    document.getElementById("deleteAll").addEventListener("click", function() {
        const allItems = document.querySelectorAll(".item-checkbox");
        allItems.forEach(item => {
            item.closest("tr").remove();
        });
        updateTotalPrice();
    });

    //총 금액 출력
    function updateTotalPrice() {
        let totalPrice = 0;
        const selectedItems = document.querySelectorAll(".item-checkbox:checked");
        selectedItems.forEach(item => {
            const row = item.closest("tr");
            const price = parseFloat(row.querySelector("td:nth-child(3)").textContent.replace(/[^\d.-]/g, ""));
            const quantity = parseInt(row.querySelector("td:nth-child(4)").textContent, 10);
            totalPrice += price * quantity;
        });
        document.getElementById("totalPriceText").textContent = "총 금액: " + totalPrice + " 원";
    }
</script>
<script th:src="@{/js/editor.js}"></script>
<script th:src="@{/js/mylist.js}"></script>
</head>
<body>
	<section layout:fragment="content" class="content-box d-flex"
		style="gap: 30px; padding-top: 30px;">
		<div class="text-center bg-body-secondary" style="width: 200px;">
			<h6
				class="m-0 py-3 border-bottom border-secondary-subtle text-body-emphasis">
				<a href="order">마이 페이지</a>
			</h6>
			<ul class="p-0 text-center">
				<li class="mt-2 text-body-emphasis"><a href="order">내 주문/배송</a></li>
				<li class="mt-2 text-body-emphasis"><a href="review">내 리뷰</a></li>
				<li class="mt-2 text-body-emphasis"><a href="qna">내 Q&A</a></li>
			</ul>
		</div>
		<div class="d-flex flex-column gap-3 w-100">
			<div class="my-content" id="myQAContent">
				<div>
					<table class="table-type-a">
						<thead>
							<tr>
								<!-- 전체 선택 체크박스 -->
								<th><input type="checkbox" id="selectAll" /></th>
								<th>상품이미지</th>
								<th>상품명</th>
								<th>판매가</th>
								<th>수량</th>
								<th>평점</th>
							</tr>
						</thead>
						<tbody>
							<tr th:if="${#lists.isEmpty(carts)}">
								<td colspan="2">---- 장바구니 내역이 없습니다. ----</td>
							</tr>
							<tr th:each="item : ${carts}"
								th:unless="${#lists.isEmpty(carts)}">
								<!-- 상품별 체크박스 -->
								<td><input type="checkbox" class="item-checkbox"
									data-order-id="${item.orderId}" /></td>
								<td th:text="${item.productImageUrl}" />
								<td th:text="${item.productName}" />
								<td th:text="${item.productPrice}" />
								<td th:text="${item.quantity}" />
								<td th:text="${item.avgRating}" />
							</tr>
						</tbody>
					</table>
				</div>
				<div class="mt-3 d-flex justify-content-start gap-2">
					<button class="btn btn-secondary" id="deleteAll">장바구니 비우기</button>
					<button class="btn btn-danger" id="deleteSelected">선택 삭제</button>
					<button class="btn btn-primary" id="checkCompatibilityBtn">부품 호환성 체크</button>
				</div>
				<div id="entityDetailContainer">
					<!-- 총 금액 출력 -->
				</div>
			</div>
		</div>
	</section>
</body>
</html>
