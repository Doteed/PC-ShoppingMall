<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/auth-layout}">
<head>
<meta charset="UTF-8">
	<title>주문 관리 페이지</title>
	<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
		    var addressSearchBtn = document.getElementById('addressSearchBtn');
		    addressSearchBtn.addEventListener('click', execDaumPostcode);
		});
	
		function execDaumPostcode() {
		    new daum.Postcode({
		        oncomplete: function(data) {
		            var addr = '';
		            var extraAddr = '';
	
		            if (data.userSelectedType === 'R') {
		                addr = data.roadAddress;
		            } else {
		                addr = data.jibunAddress;
		            }
	
		            if(data.userSelectedType === 'R'){
		                if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
		                    extraAddr += data.bname;
		                }
		                if(data.buildingName !== '' && data.apartment === 'Y'){
		                    extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
		                }
		                if(extraAddr !== ''){
		                    extraAddr = ' (' + extraAddr + ')';
		                }
		                document.getElementById("extraAddress").value = extraAddr;
		            } else {
		                document.getElementById("extraAddress").value = '';
		            }
	
		            document.getElementById('postcode').value = data.zonecode;
		            document.getElementById("address").value = addr;
		            document.getElementById("detailAddress").focus();
		        }
		    }).open();
		}
	</script>
</head>
<body>
	<div layout:fragment="content" class="d-flex flex-column gap-3 w-100">
        <h5>주문리스트</h5>
        <div>
            <table class="table-type-a">
                <thead>
                    <tr>
                        <th>주문ID</th>
                        <th>주문일자</th>
                        <th>상품명</th>
                        <th>주문자</th>
                        <th>총 가격</th>
                        <th>주문 상태</th>
                    </tr>
                </thead>
					<tbody>
					    <tr th:if="${#lists.isEmpty(orders)}">
					        <td colspan="6" class="text-center">주문 목록이 비어있습니다.</td>
					    </tr>
					    <tr th:unless="${#lists.isEmpty(orders)}" th:each="order : ${orders}">
					        <td th:text="${order.orderId}" data-bs-toggle="modal" data-bs-target="#orderModal"></td>
					        <td th:text="${#dates.format(order.orderDate, 'yyyy-MM-dd HH:mm:ss')}"></td>
					        <td th:text="${order.productName}"></td>
					        <td th:text="${order.userId}"></td>
					        <td th:text="${#numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 0, 'POINT')} + '원'"></td>
					        <td th:text="${order.orderStatus}"></td>
					    </tr>
					</tbody>
            </table>
        </div>
	    <!-- Modal -->
	    <div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
	        <div class="modal-dialog modal-lg">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="orderModalLabel">주문 상세</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                    <form th:action="@{/order/update}" method="post" th:object="${orderDto}">
	                        <input type="hidden" th:field="*{orderId}" />
	                        <div class="form-group">
	                            <label for="userId">주문자 ID</label>
	                            <input type="text" class="form-control" id="userId" th:field="*{userId}" readonly />
	                        </div>
	                        <div class="form-group">
	                            <label for="productId">상품 ID</label>
	                            <input type="number" class="form-control" id="productId" th:field="*{productId}" readonly />
	                        </div>
	                        <div class="form-group">
	                            <label for="totalPrice">총 가격</label>
	                            <input type="number" class="form-control" id="totalPrice" th:field="*{totalPrice}" />
	                        </div>
	                        <div class="form-group">
	                            <label for="paymentMethod">결제 방법</label>
	                            <input type="text" class="form-control" id="paymentMethod" th:field="*{paymentMethod}" />
	                        </div>
	                        <div class="form-group">
	                            <label for="orderDate">주문 날짜</label>
	                            <input type="datetime-local" class="form-control" id="orderDate" th:field="*{orderDate}" />
	                        </div>
	                        <div class="form-group">
	                            <label for="orderStatus">주문 상태</label>
	                            <select class="form-control" id="orderStatus" th:field="*{orderStatus}">
	                                <option value="PENDING">대기 중</option>
	                                <option value="PROCESSING">처리 중</option>
	                                <option value="SHIPPED">배송 중</option>
	                                <option value="DELIVERED">배송 완료</option>
	                                <option value="CANCELLED">취소됨</option>
	                            </select>
	                        </div>
	                        <div class="form-group">
	                            <label for="quantity">주문 수량</label>
	                            <input type="number" class="form-control" id="quantity" th:field="*{quantity}" />
	                        </div>
	                        <button type="submit" class="btn btn-primary">저장</button>
	                    </form>
	                </div>
	            </div>
	        </div>
	    </div>
    </div>
</body>
</html>